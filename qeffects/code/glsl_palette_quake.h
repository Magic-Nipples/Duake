/*
*
*	Copyright (c) 2024, Magic Nipples.
*
*	Use and modification of this code is allowed as long
*	as credit is provided! Enjoy!
*
*/
#ifndef QFX_GLPALQUAKE_H
#define QFX_GLPALQUAKE_H

//==========================================================================
// Palettize - make render limited to defined palette
//==========================================================================
static const char g_szVertexShader_QUAKE[] =
"#version 120\n"
"void main(void)\n"
"{\n"
"gl_TexCoord[0] = gl_MultiTexCoord0;\n"
"gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;\n"
"}\n";

static const char g_szFragmentShader_QUAKE[] =
"#version 120\n"
"#extension GL_ARB_texture_rectangle : enable\n"
"uniform sampler2DRect Texture0;\n"
//"vec3 palette[256];\n"
"vec3 palette[296];\n"
"int total = 295; \n" //255

"void main(void)\n"
"{\n"

//row 01
"palette[0] = vec3(0., 0., 0.).rgb; \n"
"palette[1] = vec3(15, 15, 15).rgb; \n"
"palette[2] = vec3(31, 31, 31).rgb; \n"
"palette[3] = vec3(47, 47, 47).rgb; \n"
"palette[4] = vec3(63, 63, 63).rgb; \n"
"palette[5] = vec3(75, 75, 75).rgb; \n"
"palette[6] = vec3(91, 91, 91).rgb; \n"
"palette[7] = vec3(107, 107, 107).rgb; \n"
"palette[8] = vec3(123, 123, 123).rgb; \n"
"palette[9] = vec3(139, 139, 139).rgb; \n"
"palette[10] = vec3(155, 155, 155).rgb; \n"
"palette[11] = vec3(171, 171, 171).rgb; \n"
"palette[12] = vec3(187, 187, 187).rgb; \n"
"palette[13] = vec3(203, 203, 203).rgb; \n"
"palette[14] = vec3(219, 219, 219).rgb; \n"
"palette[15] = vec3(235, 235, 235).rgb; \n"

//row 02
"palette[16] = vec3(15, 11, 7).rgb; \n"
"palette[17] = vec3(23, 15, 11).rgb; \n"
"palette[18] = vec3(31, 23, 11).rgb; \n"
"palette[19] = vec3(39, 27, 15).rgb; \n"
"palette[20] = vec3(47, 35, 19).rgb; \n"
"palette[21] = vec3(55, 43, 23).rgb; \n"
"palette[22] = vec3(63, 47, 23).rgb; \n"
"palette[23] = vec3(75, 55, 27).rgb; \n"
"palette[24] = vec3(83, 59, 27).rgb; \n"
"palette[25] = vec3(91, 67, 31).rgb; \n"
"palette[26] = vec3(99, 75, 31).rgb; \n"
"palette[27] = vec3(107, 83, 31).rgb; \n"
"palette[28] = vec3(115, 87, 31).rgb; \n"
"palette[29] = vec3(123, 95, 35).rgb; \n"
"palette[30] = vec3(131, 103, 35).rgb; \n"
"palette[31] = vec3(143, 111, 35).rgb; \n"

//row 03
"palette[32] = vec3(11, 11, 15).rgb; \n"
"palette[33] = vec3(19, 19, 27).rgb; \n"
"palette[34] = vec3(27, 27, 39).rgb; \n"
"palette[35] = vec3(39, 39, 51).rgb; \n"
"palette[36] = vec3(47, 47, 63).rgb; \n"
"palette[37] = vec3(55, 55, 75).rgb; \n"
"palette[38] = vec3(63, 63, 87).rgb; \n"
"palette[39] = vec3(71, 71, 103).rgb; \n"
"palette[40] = vec3(79, 79, 115).rgb; \n"
"palette[41] = vec3(91, 91, 127).rgb; \n"
"palette[42] = vec3(99, 99, 139).rgb; \n"
"palette[43] = vec3(107, 107, 151).rgb; \n"
"palette[44] = vec3(115, 115, 163).rgb; \n"
"palette[45] = vec3(123, 123, 175).rgb; \n"
"palette[46] = vec3(131, 131, 187).rgb; \n"
"palette[47] = vec3(139, 139, 203).rgb; \n"

//row 04
"palette[48] = vec3(3, 3, 0).rgb; \n"
"palette[49] = vec3(7, 7, 0).rgb; \n"
"palette[50] = vec3(11, 11, 0).rgb; \n"
"palette[51] = vec3(19, 19, 0).rgb; \n"
"palette[52] = vec3(27, 27, 0).rgb; \n"
"palette[53] = vec3(35, 35, 0).rgb; \n"
"palette[54] = vec3(43, 43, 7).rgb; \n"
"palette[55] = vec3(47, 47, 7).rgb; \n"
"palette[56] = vec3(55, 55, 7).rgb; \n"
"palette[57] = vec3(63, 63, 7).rgb; \n"
"palette[58] = vec3(71, 71, 7).rgb; \n"
"palette[59] = vec3(75, 75, 11).rgb; \n"
"palette[60] = vec3(83, 83, 11).rgb; \n"
"palette[61] = vec3(91, 91, 11).rgb; \n"
"palette[62] = vec3(99, 99, 11).rgb; \n"
"palette[63] = vec3(107, 107, 15).rgb; \n"

//row 05
"palette[64] = vec3(7, 0, 0).rgb; \n"
"palette[65] = vec3(15, 0, 0).rgb; \n"
"palette[66] = vec3(23, 0, 0).rgb; \n"
"palette[67] = vec3(31, 0, 0).rgb; \n"
"palette[68] = vec3(39, 0, 0).rgb; \n"
"palette[69] = vec3(47, 0, 0).rgb; \n"
"palette[70] = vec3(55, 0, 0).rgb; \n"
"palette[71] = vec3(63, 0, 0).rgb; \n"
"palette[72] = vec3(71, 0, 0).rgb; \n"
"palette[73] = vec3(79, 0, 0).rgb; \n"
"palette[74] = vec3(87, 0, 0).rgb; \n"
"palette[75] = vec3(95, 0, 0).rgb; \n"
"palette[76] = vec3(103, 0, 0).rgb; \n"
"palette[77] = vec3(111, 0, 0).rgb; \n"
"palette[78] = vec3(199, 0, 0).rgb; \n"
"palette[79] = vec3(127, 0, 0).rgb; \n"

//row 06
"palette[80] = vec3(19, 19, 0).rgb; \n"
"palette[81] = vec3(27, 27, 0).rgb; \n"
"palette[82] = vec3(35, 35, 0).rgb; \n"
"palette[83] = vec3(47, 43, 0).rgb; \n"
"palette[84] = vec3(55, 47, 0).rgb; \n"
"palette[85] = vec3(67, 55, 0).rgb; \n"
"palette[86] = vec3(75, 59, 7).rgb; \n"
"palette[87] = vec3(87, 67, 7).rgb; \n"
"palette[88] = vec3(95, 71, 7).rgb; \n"
"palette[89] = vec3(107, 75, 11).rgb; \n"
"palette[90] = vec3(119, 83, 15).rgb; \n"
"palette[91] = vec3(131, 87, 19).rgb; \n"
"palette[92] = vec3(139, 91, 19).rgb; \n"
"palette[93] = vec3(151, 95, 27).rgb; \n"
"palette[94] = vec3(163, 99, 31).rgb; \n"
"palette[95] = vec3(175, 103, 35).rgb; \n"

//row 07
"palette[96] = vec3(35, 19, 7).rgb; \n"
"palette[97] = vec3(47, 23, 11).rgb; \n"
"palette[98] = vec3(59, 31, 15).rgb; \n"
"palette[99] = vec3(75, 35, 19).rgb; \n"
"palette[100] = vec3(87, 43, 24).rgb; \n"
"palette[101] = vec3(99, 47, 31).rgb; \n"
"palette[102] = vec3(115, 55, 35).rgb; \n"
"palette[103] = vec3(127, 59, 43).rgb; \n"
"palette[104] = vec3(143, 63, 51).rgb; \n"
"palette[105] = vec3(159, 79, 51).rgb; \n"
"palette[106] = vec3(175, 99, 47).rgb; \n"
"palette[107] = vec3(191, 119, 47).rgb; \n"
"palette[108] = vec3(207, 143, 43).rgb; \n"
"palette[109] = vec3(223, 171, 39).rgb; \n"
"palette[110] = vec3(239, 203, 31).rgb; \n"
"palette[111] = vec3(255, 243, 27).rgb; \n"

//row 08
"palette[112] = vec3(11, 7, 0).rgb; \n"
"palette[113] = vec3(27, 19, 0).rgb; \n"
"palette[114] = vec3(43, 35, 15).rgb; \n"
"palette[115] = vec3(55, 43, 19).rgb; \n"
"palette[116] = vec3(71, 51, 27).rgb; \n"
"palette[117] = vec3(83, 55, 35).rgb; \n"
"palette[118] = vec3(99, 63, 43).rgb; \n"
"palette[119] = vec3(11, 71, 51).rgb; \n"
"palette[120] = vec3(127, 83, 63).rgb; \n"
"palette[121] = vec3(139, 95, 71).rgb; \n"
"palette[122] = vec3(155, 107, 83).rgb; \n"
"palette[123] = vec3(167, 123, 95).rgb; \n"
"palette[124] = vec3(183, 135, 107).rgb; \n"
"palette[125] = vec3(195, 147, 123).rgb; \n"
"palette[126] = vec3(211, 163, 139).rgb; \n"
"palette[127] = vec3(227, 179, 151).rgb; \n"

//row 09
"palette[128] = vec3(171, 139, 163).rgb; \n"
"palette[129] = vec3(159, 127, 151).rgb; \n"
"palette[130] = vec3(147, 115, 135).rgb; \n"
"palette[131] = vec3(139, 103, 123).rgb; \n"
"palette[132] = vec3(127, 91, 111).rgb; \n"
"palette[133] = vec3(119, 83, 99).rgb; \n"
"palette[134] = vec3(107, 75, 87).rgb; \n"
"palette[135] = vec3(95, 63, 75).rgb; \n"
"palette[136] = vec3(87, 55, 67).rgb; \n"
"palette[137] = vec3(75, 47, 55).rgb; \n"
"palette[138] = vec3(67, 39, 47).rgb; \n"
"palette[139] = vec3(55, 31, 35).rgb; \n"
"palette[140] = vec3(43, 23, 27).rgb; \n"
"palette[141] = vec3(35, 19, 19).rgb; \n"
"palette[142] = vec3(23, 11, 11).rgb; \n"
"palette[143] = vec3(15, 7, 7).rgb; \n"

//row 10
"palette[144] = vec3(187, 115, 159).rgb; \n"
"palette[145] = vec3(175, 107, 143).rgb; \n"
"palette[146] = vec3(163, 95, 131).rgb; \n"
"palette[147] = vec3(151, 87, 119).rgb; \n"
"palette[148] = vec3(139, 79, 107).rgb; \n"
"palette[149] = vec3(127, 75, 95).rgb; \n"
"palette[150] = vec3(115, 67, 83).rgb; \n"
"palette[151] = vec3(107, 59, 75).rgb; \n"
"palette[152] = vec3(95, 51, 63).rgb; \n"
"palette[153] = vec3(83, 43, 55).rgb; \n"
"palette[154] = vec3(71, 35, 43).rgb; \n"
"palette[155] = vec3(59, 31, 35).rgb; \n"
"palette[156] = vec3(47, 23, 27).rgb; \n"
"palette[157] = vec3(35, 19, 19).rgb; \n"
"palette[158] = vec3(23, 11, 11).rgb; \n"
"palette[159] = vec3(15, 7, 7).rgb; \n"

//row 11
"palette[160] = vec3(219, 195, 187).rgb; \n"
"palette[161] = vec3(203, 179, 167).rgb; \n"
"palette[162] = vec3(191, 163, 155).rgb; \n"
"palette[163] = vec3(175, 151, 139).rgb; \n"
"palette[164] = vec3(163, 135, 123).rgb; \n"
"palette[165] = vec3(151, 123, 111).rgb; \n"
"palette[166] = vec3(135, 111, 95).rgb; \n"
"palette[167] = vec3(123, 99, 83).rgb; \n"
"palette[168] = vec3(107, 87, 71).rgb; \n"
"palette[169] = vec3(95, 75, 59).rgb; \n"
"palette[170] = vec3(83, 63, 51).rgb; \n"
"palette[171] = vec3(67, 51, 39).rgb; \n"
"palette[172] = vec3(55, 43, 31).rgb; \n"
"palette[173] = vec3(39, 31, 23).rgb; \n"
"palette[174] = vec3(11, 19, 11).rgb; \n"
"palette[175] = vec3(7, 11, 7).rgb; \n"

//row 12
"palette[176] = vec3(111, 131, 123).rgb; \n"
"palette[177] = vec3(103, 123, 111).rgb; \n"
"palette[178] = vec3(95, 115, 103).rgb; \n"
"palette[179] = vec3(87, 107, 95).rgb; \n"
"palette[180] = vec3(79, 99, 87).rgb; \n"
"palette[181] = vec3(71, 91, 79).rgb; \n"
"palette[182] = vec3(63, 83, 71).rgb; \n"
"palette[183] = vec3(55, 75, 63).rgb; \n"
"palette[184] = vec3(47, 67, 55).rgb; \n"
"palette[185] = vec3(43, 59, 47).rgb; \n"
"palette[186] = vec3(35, 51, 39).rgb; \n"
"palette[187] = vec3(31, 43, 31).rgb; \n"
"palette[188] = vec3(23, 35, 23).rgb; \n"
"palette[189] = vec3(15, 27, 19).rgb; \n"
"palette[190] = vec3(11, 19, 11).rgb; \n"
"palette[191] = vec3(7, 11, 7).rgb; \n"

//row 13
"palette[192] = vec3(255, 243, 27).rgb; \n"
"palette[193] = vec3(239, 223, 23).rgb; \n"
"palette[194] = vec3(219, 203, 19).rgb; \n"
"palette[195] = vec3(203, 183, 15).rgb; \n"
"palette[196] = vec3(187, 167, 15).rgb; \n"
"palette[197] = vec3(171, 151, 11).rgb; \n"
"palette[198] = vec3(155, 131, 7).rgb; \n"
"palette[199] = vec3(139, 115, 7).rgb; \n"
"palette[200] = vec3(123, 99, 7).rgb; \n"
"palette[201] = vec3(107, 83, 0).rgb; \n"
"palette[202] = vec3(91, 91, 0).rgb; \n"
"palette[203] = vec3(75, 55, 0).rgb; \n"
"palette[204] = vec3(59, 43, 0).rgb; \n"
"palette[205] = vec3(43, 31, 0).rgb; \n"
"palette[206] = vec3(27, 12, 0).rgb; \n"
"palette[207] = vec3(11, 7, 0).rgb; \n"

//row 14
"palette[208] = vec3(0, 0, 255).rgb; \n"
"palette[209] = vec3(11, 11, 239).rgb; \n"
"palette[210] = vec3(19, 19, 223).rgb; \n"
"palette[211] = vec3(27, 27, 207).rgb; \n"
"palette[212] = vec3(35, 35, 191).rgb; \n"
"palette[213] = vec3(43, 43, 175).rgb; \n"
"palette[214] = vec3(47, 47, 159).rgb; \n"
"palette[215] = vec3(47, 47, 143).rgb; \n"
"palette[216] = vec3(47, 47, 127).rgb; \n"
"palette[217] = vec3(47, 47, 111).rgb; \n"
"palette[218] = vec3(47, 47, 95).rgb; \n"
"palette[219] = vec3(43, 43, 79).rgb; \n"
"palette[220] = vec3(35, 35, 64).rgb; \n"
"palette[221] = vec3(27, 27, 47).rgb; \n"
"palette[222] = vec3(19, 19, 31).rgb; \n"
"palette[223] = vec3(11, 11, 15).rgb; \n"

//row 15
"palette[224] = vec3(43, 0, 0).rgb; \n"
"palette[225] = vec3(59, 0, 0).rgb; \n"
"palette[226] = vec3(75, 7, 0).rgb; \n"
"palette[227] = vec3(95, 7, 0).rgb; \n"
"palette[228] = vec3(111, 15, 0).rgb; \n"
"palette[229] = vec3(123, 23, 7).rgb; \n"
"palette[230] = vec3(147, 31, 7).rgb; \n"
"palette[231] = vec3(163, 39, 11).rgb; \n"
"palette[232] = vec3(183, 51, 15).rgb; \n"
"palette[233] = vec3(195, 75, 27).rgb; \n"
"palette[234] = vec3(207, 99, 43).rgb; \n"
"palette[235] = vec3(219, 127, 59).rgb; \n"
"palette[236] = vec3(227, 151, 79).rgb; \n"
"palette[237] = vec3(231, 171, 95).rgb; \n"
"palette[238] = vec3(239, 191, 119).rgb; \n"
"palette[239] = vec3(247, 211, 139).rgb; \n"

//row 16
"palette[240] = vec3(167, 123, 59).rgb; \n"
"palette[241] = vec3(183, 155, 55).rgb; \n"
"palette[242] = vec3(199, 195, 55).rgb; \n"
"palette[243] = vec3(231, 227, 87).rgb; \n"
"palette[244] = vec3(0, 255, 0).rgb; \n"
"palette[245] = vec3(171, 231, 255).rgb; \n"
"palette[246] = vec3(215, 255, 255).rgb; \n"
"palette[247] = vec3(103, 0, 0).rgb; \n"
"palette[248] = vec3(139, 0, 0).rgb; \n"
"palette[249] = vec3(179, 0, 0).rgb; \n"
"palette[250] = vec3(215, 0, 0).rgb; \n"
"palette[251] = vec3(255, 0, 0).rgb; \n"
"palette[252] = vec3(255, 243, 147).rgb; \n"
"palette[253] = vec3(255, 247, 199).rgb; \n"
"palette[254] = vec3(159, 91, 83).rgb; \n"
"palette[255] = vec3(255, 255, 255).rgb; \n"

//row 08 - DOOM
"palette[256] = vec3(119., 255., 111.).rgb; \n"
"palette[257] = vec3(111., 239., 103.).rgb; \n"
"palette[258] = vec3(103., 223., 95.).rgb; \n"
"palette[259] = vec3(95., 207., 87.).rgb; \n"
"palette[260] = vec3(91., 191., 79.).rgb; \n"
"palette[261] = vec3(83., 175., 71.).rgb; \n"
"palette[262] = vec3(75., 159., 63.).rgb; \n"
"palette[263] = vec3(67., 147., 55.).rgb; \n"
"palette[264] = vec3(63., 131., 47.).rgb; \n"
"palette[265] = vec3(55., 115., 43.).rgb; \n"
"palette[266] = vec3(47., 99., 35.).rgb; \n"
"palette[267] = vec3(39., 93., 27.).rgb; \n"
"palette[268] = vec3(31., 67., 23.).rgb; \n"
"palette[269] = vec3(23., 51., 15.).rgb; \n"
"palette[270] = vec3(19., 35., 11.).rgb; \n"
"palette[271] = vec3(11., 23., 7.).rgb; \n"

//row 13 - DOOM
"palette[272] = vec3(231., 231., 255.).rgb; \n"
"palette[273] = vec3(199., 199., 255.).rgb; \n"
"palette[274] = vec3(171., 171., 255.).rgb; \n"
"palette[275] = vec3(143., 143., 255.).rgb; \n"
"palette[276] = vec3(115., 115., 255.).rgb; \n"
"palette[277] = vec3(83., 83., 255.).rgb; \n"
"palette[278] = vec3(55., 55., 255.).rgb; \n"
"palette[279] = vec3(27., 27., 255.).rgb; \n"
"palette[280] = vec3(0., 0., 255.).rgb; \n"
"palette[281] = vec3(0., 0., 227.).rgb; \n"
"palette[282] = vec3(0., 0., 203.).rgb; \n"
"palette[283] = vec3(0., 0., 179.).rgb; \n"
"palette[284] = vec3(0., 0., 155.).rgb; \n"
"palette[285] = vec3(0., 0., 131.).rgb; \n"
"palette[286] = vec3(0., 0., 107.).rgb; \n"
"palette[287] = vec3(0., 0., 83.).rgb; \n"

//row 16 - DOOM need these blues
"palette[288] = vec3(0., 0., 83.).rgb; \n"
"palette[289] = vec3(0., 0., 71.).rgb; \n"
"palette[290] = vec3(0., 0., 59.).rgb; \n"
"palette[291] = vec3(0., 0., 47.).rgb; \n"
"palette[292] = vec3(0., 0., 35.).rgb; \n"
"palette[293] = vec3(0., 0., 23.).rgb; \n"
"palette[294] = vec3(0., 0., 11.).rgb; \n"
"palette[295] = vec3(0., 0., 7.).rgb; \n"

//diff
"vec3 color = texture2DRect(Texture0, gl_TexCoord[0].xy).rgb; \n"
"vec3 diff = color; \n"

"float dist = dot(diff, diff);\n" //squared distance
"float closest_dist = dist;\n"
"vec3 closest_color = vec3(0.0, 0.0, 0.0).rgb; \n"

"for (int i = 1; i <= total; i++) \n"
"{ \n"
	"diff = color - (palette[i] / total); \n"  //magic nipples - fix for the originl shader is adding [i] to prevent cast error.
	"dist = dot(diff, diff);\n"		//squared distance

	"if (dist < closest_dist)\n"  //ternary would also work here
	"{ \n"
		"closest_dist = dist;\n"
		"closest_color = palette[i] / total;\n"		//magic nipples - ^ same here.
	"} \n"
"} \n"

"gl_FragColor.rgb = closest_color;\n"
"gl_FragColor.a	= 1.0;\n"
"}\n";

#endif