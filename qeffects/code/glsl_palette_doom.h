/*
*
*	Copyright (c) 2024, Magic Nipples.
*
*	Use and modification of this code is allowed as long
*	as credit is provided! Enjoy!
*
*/
#ifndef QFX_GLPALDOOM_H
#define QFX_GLPALDOOM_H

//==========================================================================
// Palettize - make render limited to defined palette
//==========================================================================
static const char g_szVertexShader_DOOM[] =
"#version 120\n"
"void main(void)\n"
"{\n"
"gl_TexCoord[0] = gl_MultiTexCoord0;\n"
"gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;\n"
"}\n";

static const char g_szFragmentShader_DOOM[] =
"#version 120\n"
"#extension GL_ARB_texture_rectangle : enable\n"
"uniform sampler2DRect Texture0;\n"
"vec3 palette[256];\n"	//Palette from Doom 1

"void main(void)\n"
"{\n"
//row 01
"palette[0] = vec3(0, 0, 0).rgb; \n"
"palette[1] = vec3(31, 23, 11).rgb; \n"
"palette[2] = vec3(23, 15, 7).rgb; \n"
"palette[3] = vec3(75, 75, 75).rgb; \n"
"palette[4] = vec3(255, 255, 255).rgb; \n"
"palette[5] = vec3(27, 27, 27).rgb; \n"
"palette[6] = vec3(19, 19, 19).rgb; \n"
"palette[7] = vec3(11, 11, 11).rgb; \n"
"palette[8] = vec3(7, 7, 7).rgb; \n"
"palette[9] = vec3(47, 55, 31).rgb; \n"
"palette[10] = vec3(35, 43, 15).rgb; \n"
"palette[11] = vec3(23, 31, 7).rgb; \n"
"palette[12] = vec3(15, 23, 0).rgb; \n"
"palette[13] = vec3(79, 59, 43).rgb; \n"
"palette[14] = vec3(71, 51, 35).rgb; \n"
"palette[15] = vec3(63, 43, 27).rgb; \n"

//row 02 .
"palette[16] = vec3(255., 183., 183.).rgb; \n"
"palette[17] = vec3(247., 171., 171.).rgb; \n"
"palette[18] = vec3(243., 163., 163.).rgb; \n"
"palette[19] = vec3(235., 151., 151.).rgb; \n"
"palette[20] = vec3(231., 143., 143.).rgb; \n"
"palette[21] = vec3(223., 135., 135.).rgb; \n"
"palette[22] = vec3(219., 123., 123.).rgb; \n"
"palette[23] = vec3(211., 115., 115.).rgb; \n"
"palette[24] = vec3(203., 107., 107.).rgb; \n"
"palette[25] = vec3(199., 99., 99.).rgb; \n"
"palette[26] = vec3(191., 91., 91.).rgb; \n"
"palette[27] = vec3(187., 87., 87.).rgb; \n"
"palette[28] = vec3(179., 79., 79.).rgb; \n"
"palette[29] = vec3(175., 71., 71.).rgb; \n"
"palette[30] = vec3(167., 63., 63.).rgb; \n"
"palette[31] = vec3(163., 59., 59.).rgb; \n"

//row 03
"palette[32] = vec3(155., 51., 51.).rgb; \n"
"palette[33] = vec3(151., 47., 47.).rgb; \n"
"palette[34] = vec3(143., 43., 43.).rgb; \n"
"palette[35] = vec3(139., 35., 35.).rgb; \n"
"palette[36] = vec3(131., 31., 31.).rgb; \n"
"palette[37] = vec3(127., 27., 27.).rgb; \n"
"palette[38] = vec3(119., 23., 23.).rgb; \n"
"palette[39] = vec3(115., 19., 19.).rgb; \n"
"palette[40] = vec3(107., 15., 15.).rgb; \n"
"palette[41] = vec3(103., 11., 11.).rgb; \n"
"palette[42] = vec3(95., 7., 7.).rgb; \n"
"palette[43] = vec3(91., 7., 7.).rgb; \n"
"palette[44] = vec3(83., 7., 7.).rgb; \n"
"palette[45] = vec3(79., 0., 0.).rgb; \n"
"palette[46] = vec3(71., 0., 0.).rgb; \n"
"palette[47] = vec3(67., 0., 0.).rgb; \n"

//row 04
"palette[48] = vec3(255., 235., 223.).rgb; \n"
"palette[49] = vec3(255., 227., 211.).rgb; \n"
"palette[50] = vec3(255., 219., 199.).rgb; \n"
"palette[51] = vec3(255., 211., 187.).rgb; \n"
"palette[52] = vec3(255., 207., 179.).rgb; \n"
"palette[53] = vec3(255., 199., 167.).rgb; \n"
"palette[54] = vec3(255., 191., 155.).rgb; \n"
"palette[55] = vec3(255., 187., 147.).rgb; \n"
"palette[56] = vec3(255., 179., 131.).rgb; \n"
"palette[57] = vec3(247., 171., 123.).rgb; \n"
"palette[58] = vec3(239., 163., 115.).rgb; \n"
"palette[59] = vec3(231., 155., 107.).rgb; \n"
"palette[60] = vec3(223., 147., 99.).rgb; \n"
"palette[61] = vec3(215., 139., 91.).rgb; \n"
"palette[62] = vec3(207., 131., 83.).rgb; \n"
"palette[63] = vec3(203., 127., 79.).rgb; \n"

//row 05
"palette[64] = vec3(191., 123., 75.).rgb; \n"
"palette[65] = vec3(179., 115., 71.).rgb; \n"
"palette[66] = vec3(171., 111., 67.).rgb; \n"
"palette[67] = vec3(163., 107., 63.).rgb; \n"
"palette[68] = vec3(155., 99., 59.).rgb; \n"
"palette[69] = vec3(143., 95., 55.).rgb; \n"
"palette[70] = vec3(135., 87., 51.).rgb; \n"
"palette[71] = vec3(127., 83., 47.).rgb; \n"
"palette[72] = vec3(119., 79., 43.).rgb; \n"
"palette[73] = vec3(107., 71., 39.).rgb; \n"
"palette[74] = vec3(95., 67., 35.).rgb; \n"
"palette[75] = vec3(83., 63., 31.).rgb; \n"
"palette[76] = vec3(75., 55., 27.).rgb; \n"
"palette[77] = vec3(63., 47., 23.).rgb; \n"
"palette[78] = vec3(51., 43., 19.).rgb; \n"
"palette[79] = vec3(43., 35., 15.).rgb; \n"

//row 06
"palette[80] = vec3(239., 239., 239.).rgb; \n"
"palette[81] = vec3(231., 231., 231.).rgb; \n"
"palette[82] = vec3(223., 223., 223.).rgb; \n"
"palette[83] = vec3(219., 219., 219.).rgb; \n"
"palette[84] = vec3(211., 211., 211.).rgb; \n"
"palette[85] = vec3(203., 203., 203.).rgb; \n"
"palette[86] = vec3(199., 199., 199.).rgb; \n"
"palette[87] = vec3(191., 191., 191.).rgb; \n"
"palette[88] = vec3(183., 183., 183.).rgb; \n"
"palette[89] = vec3(179., 179., 179.).rgb; \n"
"palette[90] = vec3(171., 171., 171.).rgb; \n"
"palette[91] = vec3(167., 167., 167.).rgb; \n"
"palette[92] = vec3(159., 159., 159.).rgb; \n"
"palette[93] = vec3(151., 151., 151.).rgb; \n"
"palette[94] = vec3(147., 147., 147.).rgb; \n"
"palette[95] = vec3(139., 139., 139.).rgb; \n"

//row 07
"palette[96] = vec3(131., 131., 131.).rgb; \n"
"palette[97] = vec3(127., 127., 127.).rgb; \n"
"palette[98] = vec3(119., 119., 119.).rgb; \n"
"palette[99] = vec3(111., 111., 111.).rgb; \n"
"palette[100] = vec3(107., 107., 107.).rgb; \n"
"palette[101] = vec3(99., 99., 99.).rgb; \n"
"palette[102] = vec3(91., 91., 91.).rgb; \n"
"palette[103] = vec3(87., 87., 87.).rgb; \n"
"palette[104] = vec3(79., 79., 79.).rgb; \n"
"palette[105] = vec3(71., 71., 71.).rgb; \n"
"palette[106] = vec3(67., 67., 67.).rgb; \n"
"palette[107] = vec3(59., 59., 59.).rgb; \n"
"palette[108] = vec3(55., 55., 55.).rgb; \n"
"palette[109] = vec3(47., 47., 47.).rgb; \n"
"palette[110] = vec3(39., 39., 39.).rgb; \n"
"palette[111] = vec3(35., 35., 35.).rgb; \n"

//row 08
"palette[112] = vec3(119., 255., 111.).rgb; \n"
"palette[113] = vec3(111., 239., 103.).rgb; \n"
"palette[114] = vec3(103., 223., 95.).rgb; \n"
"palette[115] = vec3(95., 207., 87.).rgb; \n"
"palette[116] = vec3(91., 191., 79.).rgb; \n"
"palette[117] = vec3(83., 175., 71.).rgb; \n"
"palette[118] = vec3(75., 159., 63.).rgb; \n"
"palette[119] = vec3(67., 147., 55.).rgb; \n"
"palette[120] = vec3(63., 131., 47.).rgb; \n"
"palette[121] = vec3(55., 115., 43.).rgb; \n"
"palette[122] = vec3(47., 99., 35.).rgb; \n"
"palette[123] = vec3(39., 93., 27.).rgb; \n"
"palette[124] = vec3(31., 67., 23.).rgb; \n"
"palette[125] = vec3(23., 51., 15.).rgb; \n"
"palette[126] = vec3(19., 35., 11.).rgb; \n"
"palette[127] = vec3(11., 23., 7.).rgb; \n"

//row 09
"palette[128] = vec3(191., 167., 143.).rgb; \n"
"palette[129] = vec3(183., 159., 135.).rgb; \n"
"palette[130] = vec3(175., 151., 127.).rgb; \n"
"palette[131] = vec3(167., 143., 119.).rgb; \n"
"palette[132] = vec3(159., 135., 111.).rgb; \n"
"palette[133] = vec3(155., 127., 107.).rgb; \n"
"palette[134] = vec3(147., 123., 99.).rgb; \n"
"palette[135] = vec3(139., 115., 91.).rgb; \n"
"palette[136] = vec3(131., 107., 87.).rgb; \n"
"palette[137] = vec3(123., 99., 79.).rgb; \n"
"palette[138] = vec3(119., 95., 75.).rgb; \n"
"palette[139] = vec3(111., 87., 67.).rgb; \n"
"palette[140] = vec3(103., 83., 63.).rgb; \n"
"palette[141] = vec3(95., 75., 55.).rgb; \n"
"palette[142] = vec3(87., 67., 51.).rgb; \n"
"palette[143] = vec3(83., 63., 47.).rgb; \n"

//row 10
"palette[144] = vec3(159., 131., 99.).rgb; \n"
"palette[145] = vec3(143., 119., 83.).rgb; \n"
"palette[146] = vec3(131., 107., 75.).rgb; \n"
"palette[147] = vec3(119., 95., 63.).rgb; \n"
"palette[148] = vec3(103., 83., 51.).rgb; \n"
"palette[149] = vec3(91., 71., 43.).rgb; \n"
"palette[150] = vec3(79., 59., 35.).rgb; \n"
"palette[151] = vec3(67., 51., 27.).rgb; \n"
"palette[152] = vec3(123., 127., 99.).rgb; \n"
"palette[153] = vec3(111., 115., 87.).rgb; \n"
"palette[154] = vec3(103., 107., 79.).rgb; \n"
"palette[155] = vec3(91., 99., 71.).rgb; \n"
"palette[156] = vec3(83., 87., 59.).rgb; \n"
"palette[157] = vec3(71., 79., 51.).rgb; \n"
"palette[158] = vec3(63., 71., 43.).rgb; \n"
"palette[159] = vec3(55., 63., 39.).rgb; \n"

//row 11
"palette[160] = vec3(255., 255., 115.).rgb; \n"
"palette[161] = vec3(235., 219., 87.).rgb; \n"
"palette[162] = vec3(215., 187., 67.).rgb; \n"
"palette[163] = vec3(195., 155., 47.).rgb; \n"
"palette[164] = vec3(175., 123., 31.).rgb; \n"
"palette[165] = vec3(155., 91., 19.).rgb; \n"
"palette[166] = vec3(135., 67., 7.).rgb; \n"
"palette[167] = vec3(115., 43., 0.).rgb; \n"
"palette[168] = vec3(255., 255., 255.).rgb; \n"
"palette[169] = vec3(255., 219., 219.).rgb; \n"
"palette[170] = vec3(255., 187., 187.).rgb; \n"
"palette[171] = vec3(255., 155., 155.).rgb; \n"
"palette[172] = vec3(255., 123., 123.).rgb; \n"
"palette[173] = vec3(255., 95., 95.).rgb; \n"
"palette[174] = vec3(255., 63., 63.).rgb; \n"
"palette[175] = vec3(255., 31., 31.).rgb; \n"

//row 12
"palette[176] = vec3(255., 0., 0.).rgb; \n"
"palette[177] = vec3(239., 0., 0.).rgb; \n"
"palette[178] = vec3(227., 0., 0.).rgb; \n"
"palette[179] = vec3(215., 0., 0.).rgb; \n"
"palette[180] = vec3(203., 0., 0.).rgb; \n"
"palette[181] = vec3(191., 0., 0.).rgb; \n"
"palette[182] = vec3(179., 0., 0.).rgb; \n"
"palette[183] = vec3(167., 0., 0.).rgb; \n"
"palette[184] = vec3(155., 0., 0.).rgb; \n"
"palette[185] = vec3(139., 0., 0.).rgb; \n"
"palette[186] = vec3(127., 0., 0.).rgb; \n"
"palette[187] = vec3(115., 0., 0.).rgb; \n"
"palette[188] = vec3(103., 0., 0.).rgb; \n"
"palette[189] = vec3(91., 0., 0.).rgb; \n"
"palette[190] = vec3(79., 0., 0.).rgb; \n"
"palette[191] = vec3(67., 0., 0.).rgb; \n"

//row 13
"palette[192] = vec3(231., 231., 255.).rgb; \n"
"palette[193] = vec3(199., 199., 255.).rgb; \n"
"palette[194] = vec3(171., 171., 255.).rgb; \n"
"palette[195] = vec3(143., 143., 255.).rgb; \n"
"palette[196] = vec3(115., 115., 255.).rgb; \n"
"palette[197] = vec3(83., 83., 255.).rgb; \n"
"palette[198] = vec3(55., 55., 255.).rgb; \n"
"palette[199] = vec3(27., 27., 255.).rgb; \n"
"palette[200] = vec3(0., 0., 255.).rgb; \n"
"palette[201] = vec3(0., 0., 227.).rgb; \n"
"palette[202] = vec3(0., 0., 203.).rgb; \n"
"palette[203] = vec3(0., 0., 179.).rgb; \n"
"palette[204] = vec3(0., 0., 155.).rgb; \n"
"palette[205] = vec3(0., 0., 131.).rgb; \n"
"palette[206] = vec3(0., 0., 107.).rgb; \n"
"palette[207] = vec3(0., 0., 83.).rgb; \n"

//row 14
"palette[208] = vec3(255., 255., 255.).rgb; \n"
"palette[209] = vec3(255., 235., 219.).rgb; \n"
"palette[210] = vec3(255., 215., 187.).rgb; \n"
"palette[211] = vec3(255., 199., 155.).rgb; \n"
"palette[212] = vec3(255., 179., 123.).rgb; \n"
"palette[213] = vec3(255., 163., 91.).rgb; \n"
"palette[214] = vec3(255., 143., 59.).rgb; \n"
"palette[215] = vec3(255., 127., 27.).rgb; \n"
"palette[216] = vec3(243., 115., 23.).rgb; \n"
"palette[217] = vec3(235., 111., 15.).rgb; \n"
"palette[218] = vec3(223., 103., 15.).rgb; \n"
"palette[219] = vec3(215., 95., 11.).rgb; \n"
"palette[220] = vec3(203., 87., 7.).rgb; \n"
"palette[221] = vec3(195., 79., 0.).rgb; \n"
"palette[222] = vec3(183., 71., 0.).rgb; \n"
"palette[223] = vec3(175., 67., 0.).rgb; \n"

//row 15
"palette[224] = vec3(255., 255., 255.).rgb; \n"
"palette[225] = vec3(255., 255., 215.).rgb; \n"
"palette[226] = vec3(255., 255., 179.).rgb; \n"
"palette[227] = vec3(255., 255., 143.).rgb; \n"
"palette[228] = vec3(255., 255., 107.).rgb; \n"
"palette[229] = vec3(255., 255., 71.).rgb; \n"
"palette[230] = vec3(255., 255., 35.).rgb; \n"
"palette[231] = vec3(255., 255., 0.).rgb; \n"
"palette[232] = vec3(167., 63., 0.).rgb; \n"
"palette[233] = vec3(159., 55., 0.).rgb; \n"
"palette[234] = vec3(147., 47., 0.).rgb; \n"
"palette[235] = vec3(135., 35., 0.).rgb; \n"
"palette[236] = vec3(79., 59., 39.).rgb; \n"
"palette[237] = vec3(67., 47., 27.).rgb; \n"
"palette[238] = vec3(55., 35., 19.).rgb; \n"
"palette[239] = vec3(47., 27., 11.).rgb; \n"

//row 16
"palette[240] = vec3(0., 0., 83.).rgb; \n"
"palette[241] = vec3(0., 0., 71.).rgb; \n"
"palette[242] = vec3(0., 0., 59.).rgb; \n"
"palette[243] = vec3(0., 0., 47.).rgb; \n"
"palette[244] = vec3(0., 0., 35.).rgb; \n"
"palette[245] = vec3(0., 0., 23.).rgb; \n"
"palette[246] = vec3(0., 0., 11.).rgb; \n"
"palette[247] = vec3(0., 0., 7.).rgb; \n"
"palette[248] = vec3(255., 159., 67.).rgb; \n"
"palette[249] = vec3(255., 231., 75.).rgb; \n"
"palette[250] = vec3(255., 123., 255.).rgb; \n"
"palette[251] = vec3(255., 0., 255.).rgb; \n"
"palette[252] = vec3(207., 0., 207.).rgb; \n"
"palette[253] = vec3(159., 0., 155.).rgb; \n"
"palette[254] = vec3(111., 0., 107.).rgb; \n"
"palette[255] = vec3(167., 107., 107.).rgb; \n"

//diff
"vec3 color = texture2DRect(Texture0, gl_TexCoord[0].xy).rgb; \n"
"vec3 diff = color; \n"

"float dist = dot(diff, diff);\n" //squared distance
"float closest_dist = dist;\n"
"vec3 closest_color = vec3(0.0, 0.0, 0.0).rgb; \n"

"for (int i = 1; i <= 255; i++) \n"
"{ \n"
	"diff = color - (palette[i] / 255.0); \n"  //magic nipples - fix for the originl shader is adding [i] to prevent cast error.
	"dist = dot(diff, diff);\n"		//squared distance

	"if (dist < closest_dist)\n"  //ternary would also work here
	"{ \n"
		"closest_dist = dist;\n"
		"closest_color = palette[i] / 255.0;\n"		//magic nipples - ^ same here.
	"} \n"
"} \n"

"gl_FragColor.rgb = closest_color;\n"
"gl_FragColor.a	= 1.0;\n"
"}\n";

#endif